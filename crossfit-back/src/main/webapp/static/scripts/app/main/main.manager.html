<div ng-cloak>
    <div class="row">
        <div class="col-md-12">
            <div ng-switch="isAuthenticated()">

                <div class="alert alert-warning" ng-switch-when="false" translate="global.messages.info.authenticated">
                    If you want to <a href="#/login">authenticate</a>, you can try the default accounts:<br/>- Administrator (login="admin" and password="admin") <br/>- User (login="user" and password="user").
                </div>
                
                
                <div class="planning" ng-switch-when="true">
                
           			<div ng-class="{active: $state.includes('stats')}"  has-any-role="ROLE_ADMIN,ROLE_DIRECTOR" style="float: right;">
						<a ui-sref="stats"> <span
							class="glyphicon glyphicon-stats"
							title="{{'global.menu.stats'|translate}}"></span>
						</a>
					</div>
					
                	<div class="row">
						<div class="col-lg-12">
			
							<div class="panel with-nav-tabs panel-info" ng-if="hasHealthIndicator()" has-any-role="ROLE_ADMIN,ROLE_DIRECTOR,ROLE_MANAGER">
								<div class="panel-heading">
									<h5>Informations importantes</h5>
								</div>
								<div class="panel-body">
																	
									<div class="panel panel-danger close-slot" ng-if="hasHealthIndicator()" has-any-role="ROLE_ADMIN,ROLE_DIRECTOR,ROLE_MANAGER">
						                <div class="panel-heading">
						                 	<div class="row">		
											  	<div class="col-xs-12"> 
											  		<button class="btn btn-sm btn-default pull-left toggle-button" ng-click="toggle($event)">
											  			<span class="glyphicon"></span>
											  		</button>
											  																	  																			
													<h5>Il y a des incohérences dans les données</h5>
												</div>
											</div>
										</div>
								
										<ul class="list-group">
											<li class="list-group-item three-points-overflow" ng-repeat="(indicator, count) in membersHealthCount">
					       						{{'crossfitApp.member.health.enum.' + indicator | translate}}: {{count}}
					       					</li>
					       				</ul>
									</div>
									
				                	<div class="alert alert-warning"  ng-if="planning.length == 0" translate="main.planning.no.timeslot"></div>
								
								   	<jh-alert></jh-alert>
								</div>
							</div>
					    </div>
					</div>
					
					<div class="panel with-nav-tabs panel-default">
                		<div class="panel-heading">
		                	<ul class="nav nav-tabs">
							  <li role="presentation">
							  		<a href="#" ng-click="prev()"><</a>
							  </li>
							  <li role="presentation" ng-class="{'active': $index==selectedIndex}" ng-repeat="day in planning">
							  		<a href="#" class="visible-sm-block visible-md-block visible-lg-block" ng-click="select($index)">{{day.date | date:'EEE dd MMM'}}</a>
							  		<a href="#" class="hidden-sm hidden-md hidden-lg" ng-click="select($index)">{{day.date | date:'EEE dd'}}</a>
							  </li>
							  <li role="presentation">
							  		<a href="#" ng-click="next()">></a>
							  </li>
							</ul>
						</div>
						<div class="panel-body">
                    		<div class="tab-content">
								<div class="row">
			        				<div class="col-md-12">
			        					<div class="row" ng-if="planning[selectedIndex].slotsByInterval.length == 0">
				        					<div class="col-md-12" translate="main.planning.no.timeslot.thisday">
				        					</div>
			        					</div>
										<div class="row" ng-repeat="interval in planning[selectedIndex].slotsByInterval">
					        				<div class="col-md-12">
												<div class="row">
													<div class="{{'col-md-' +  (12 / interval.slots.length) }}" ng-repeat="slot in interval.slots">
														
														<div class="panel panel-default" ng-class="calculateCssClass(slot)" >
															<div class="panel-heading">
															 	<div class="row">		
																  	<div class="col-xs-9"> 
																  		<button class="btn btn-sm btn-default pull-left toggle-button" ng-click="forceOpen($event, slot)">
																  			<span class="glyphicon"></span>
																  		</button>
																  																	  																			
																		<h5 class="visible-sm-block visible-md-block visible-lg-block">
																			{{slot.start | date:'HH:mm'}} - {{slot.end | date:'HH:mm'}} | 
																			{{slot.bookings.length}}/{{slot.maxAttendees}} inscrits {{slot.waintingNotifs.length > 0 ? ' (+' + slot.waintingNotifs.length + ')' : ''}} |
																			{{slot.timeSlotType.name}} 
																				  
																			<a ui-sref="timeSlot.edit({id:slot.id})" has-any-role="ROLE_ADMIN,ROLE_MANAGER">
																				<span class="glyphicon glyphicon-pencil"></span>
																			</a>
																		</h5>
																		<h6 class="hidden-sm hidden-md hidden-lg">
																			{{slot.start | date:'HH:mm'}} | {{slot.bookings.length}}/{{slot.maxAttendees}} {{slot.waintingNotifs.length > 0 ? ' (+' + slot.waintingNotifs.length + ')' : ''}}
																		</h6>
																	</div>
																	<div class="col-xs-3">
																		<button class="btn btn-sm btn-default pull-right" has-any-role="ROLE_ADMIN,ROLE_MANAGER" ng-click="showQuickAddBooking(slot)">
																			<span class="glyphicon glyphicon-plus"></span>
																		</button>
																		<div class="clearfix"></div>
																	</div>
																</div>
															</div>														
															<ul class="list-group">
																<li class="list-group-item three-points-overflow" ng-repeat="wait in slot.waintingNotifs">
																	<span class="glyphicon glyphicon-time" title="En attente"></span>
																	{{wait.firstName}} {{wait.lastName}}
																	
																	<a href="#" ui-sref="member.edit({id:wait.id})" has-any-role="ROLE_ADMIN,ROLE_MANAGER" class="hidden-xs">
																		<span class="glyphicon glyphicon-pencil"></span>
																	</a>
																</li>
																<li class="list-group-item" ng-repeat="booking in slot.bookings">
																	<div class="btn-group pull-right">
																	  <button type="button" class="btn btn-xs btn-danger  dropdown-toggle" 
																	  		data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
																	    ...</span>
																	  </button>
																	  <ul class="dropdown-menu">
																	    <li><a ng-click="quickDeleteBooking(booking)" has-any-role="ROLE_ADMIN,ROLE_MANAGER" >
																		<span class="glyphicon glyphicon-remove"></span> Supprimer</a></li>
																	    <li><a href="sms:{{booking.memberTel}}">
																		<span class="glyphicon glyphicon-phone"></span> SMS</a></li>
																	    <li><a href="tel:{{booking.memberTel}}">
																		<span class="glyphicon glyphicon-earphone"></span> Appel</a></li>
																	  </ul>
																	</div>
																	<span has-any-role="ROLE_ADMIN,ROLE_MANAGER">
																		<button class="btn btn-sm btn-default {{booking.checkInDate || !booking.cardUuid ? 'btn-noborder' : ''}} hidden-xs" 
																			ng-disabled="booking.checkInDate != null || !booking.cardUuid" ng-click="quickCheckIn(booking)"
																			title="{{booking.checkInDate ? (booking.checkInDate | date:'HH:mm:ss') : booking.cardUuid ? 'Cliquez ici pour valider la réservation' : 'Ce membre n\'a pas de carte !'}}">
																			
																			<span class="glyphicon glyphicon-thumbs-{{booking.checkInDate ? 'up' : 'down'}} {{booking.cardUuid ? '' : 'no-card'}}"></span>
																		</button>
																	</span>
																	{{booking.title}}
																	<a href="#" ui-sref="member.edit({id:booking.memberId})" has-any-role="ROLE_ADMIN,ROLE_MANAGER" class="hidden-xs">
																				<span class="glyphicon glyphicon-pencil"></span>
																	</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                </div>
            </div>
        </div>
    </div>
    
    
   	<div class="modal fade" id="quickAddBooking">
        <div class="modal-dialog">
            <div class="modal-content">
                <form name="lockForm" ng-submit="quickAddBooking()">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"
                                ng-click="clear()">&times;</button>
                        <h4 class="modal-title" translate="main.quickbooking.title">Confirm Quick Add operation</h4>
                    </div>
                    <div class="modal-body">
                    	<jh-alert-error></jh-alert-error>
                    
                        <p>Ajouter une réservation pour la séance "{{quickbookingSlot.timeSlotType.name}}"
                         du {{quickbooking.date | date:'EEEE dd/MM'}} 
                         de {{quickbookingSlot.start | date:'HH:mm'}} à {{quickbookingSlot.end | date:'HH:mm'}}</p>
                        
                         <div class="form-group">								
						    <div class="input-group">
						      <input type="text" id="like" name="like" ng-model="quickbookingLike" ng-change="searchSubscriptionForQuickBooking()"
						      	class="form-control" placeholder="Rechercher un utilisateur..." autocomplete="false" autofocus="autofocus">
						      <span class="input-group-btn">
						        <button class="btn btn-default" type="button" ng-click="searchSubscriptionForQuickBooking()">Go!</button>
						      </span>
						    </div>
						</div>
                         <div class="form-group">						       
					        <div class="radio" ng-repeat="s in quickbookingSubscriptions">
					       		<label ng-class="calculateCssClassQuickAdd(s)">
					       			<input type="radio" name="selectSubscription"
									    value="{{s.id}}"
									    ng-click="selectSubscriptionForQuickBooking(s)">
									    {{s.member.firstName}} {{s.member.lastName}} - 
									    	{{s.membership.name}} ({{s.subscriptionStartDate}} au {{s.subscriptionEndDate}})
					       		</label>
				       		</div>
				       		
				       		<p ng-if="quickbookingSubscriptions.length == 0">Aucun résultat</p>
       					</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="clear()">
                            <span class="glyphicon glyphicon-ban-circle"></span>&nbsp;<span translate="main.quickbooking.action.cancel">Cancel</span>
                        </button>
                        <button type="submit" ng-disabled="lockForm.$invalid" class="btn btn-primary">
                            <span class="glyphicon glyphicon-add"></span>&nbsp;<span translate="main.quickbooking.action.add">Add</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
